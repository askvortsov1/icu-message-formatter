import e from"@babel/runtime/helpers/slicedToArray";import r from"@babel/runtime/helpers/classCallCheck";import t from"@babel/runtime/helpers/createClass";import n from"@babel/runtime/helpers/defineProperty";import{flatten as s}from"@ultraq/array-utils";import{memoize as i}from"@ultraq/function-utils";function o(e){for(var r=function(e){return/\s/.test(e)},t=[],n={},s=0,i=null,o=!1,l=0;l<e.length;){if(o&&(r(e[l])||"{"===e[l]))o=!1,i=e.slice(s,l),"{"===e[l]&&l--;else if(!o&&!r(e[l])){var a="{"===e[l];if(i&&a){var c=u(e,l);if(-1===c)throw new Error('Unbalanced curly braces in string: "'.concat(e,'"'));n[i]=e.slice(l+1,c),l=c,i=null}else i&&(t.push(i),i=null),o=!0,s=l}l++}return o&&(i=e.slice(s)),i&&t.push(i),{args:t,cases:n}}function l(e,r,t){for(var n,s=[],i=0;i<e.length;i++){var o=e[i];if("string"==typeof o){for(var u=0,c=null,f=!1,h=!1;u<o.length;){if(f||"<"!==o[u]){if(f&&">"===o[u]){var p=o.slice(c+1,u),v=a(e,p,i,u);if(!v)throw new Error("Unbalanced tags: no closing tag found for <".concat(p,">"));var g=v.segmentIndex===i,b=e[v.segmentIndex],d=[];if(g)d.push(o.slice(u+1,v.segmentStart));else{d.push(o.slice(u+1));for(var m=i+1;m<v.segmentIndex;m++)d.push(e[m]);d.push(b.slice(0,v.segmentStart))}s.push(o.slice(0,c)),s.push(t(p,r,l(d.filter((function(e){return""!==e})),r,t))),e.splice(v.segmentIndex+1,0,b.slice(v.segmentEnd+1)),h=!0,i=v.segmentIndex;break}f&&(n=o[u],!/[a-zA-Z-_]/.test(n))&&(c=null,f=!1)}else c=u,f=!0;u++}h||s.push(o)}else s.push(o)}return s.filter((function(e){return""!==e}))}function a(e,r,t,n){for(var s,i=1,o=t;o<e.length;o++){var l=e[o];if("string"==typeof l)for(var a=!1,u=null,c=!1,f=o===t?n:0;f<l.length;f++)if(c||"<"!==l[f])if(c&&">"===l[f]){if(l.slice(u+1+a,f)===r&&(a?i--:i++,0===i))return{segmentIndex:o,segmentStart:u,segmentEnd:f};a=!1,u=null,c=!1}else c&&(s=l[f],!/[a-zA-Z-_]/.test(s))&&(a=!1,u=null,c=!1);else u=f,c=!0,"/"===l[f+1]&&(a=!0,f++)}}function u(e,r){for(var t=0,n=r+1;n<e.length;n++){var s=e.charAt(n);if("}"===s){if(0===t)return n;t--}else"{"===s&&t++}return-1}function c(e){return f(e.slice(1,-1),",",3)}function f(e,r,t){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(!e)return n;if(1===t)return n.push(e),n;var s=e.indexOf(r);if(-1===s)return n.push(e),n;var i=e.substring(0,s).trim(),o=e.substring(s+r.length+1).trim();return n.push(i),f(o,r,t-1,n)}function h(e,r,t){return"<".concat(e,">").concat(t,"</").concat(e,">")}var p=function(){function o(e){var t=this,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;r(this,o),n(this,"format",i((function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s(t.process(e,r)).join("")}))),this.locale=e,this.typeHandlers=l,this.richHandler=a||h}return t(o,[{key:"rich",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=s(this.process(e,r));return l(t,r,this.richHandler)}},{key:"process",value:function(r){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!r)return[];var n=r.indexOf("{");if(-1!==n){var s=u(r,n);if(-1===s)throw new Error('Unbalanced curly braces in string: "'.concat(r,'"'));var i=r.substring(n,s+1);if(i){var o=[],l=r.substring(0,n);l&&o.push(l);var a=c(i),f=e(a,3),h=f[0],p=f[1],v=f[2],g=t[h];null==g&&(g="");var b=p&&this.typeHandlers[p];o.push(b?b(g,v,this.locale,t,this.process.bind(this)):g);var d=r.substring(s+1);return d&&o.push(this.process(d,t)),o}}return[r]}}]),o}();function v(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function g(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?v(Object(t),!0).forEach((function(r){n(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):v(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var b=0;function d(e,r){for(var t=0,n="",s=0,i={};t<e.length;){if("#"!==e[t]||s)n+=e[t];else{var o="__hashToken".concat(b++);n+="{".concat(o,", number}"),i[o]=r}"{"===e[t]?s++:"}"===e[t]&&s--,t++}return{caseBody:n,numberValues:i}}function m(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0,s=o(r),i=s.args,l=s.cases,a=parseInt(e);i.forEach((function(e){e.startsWith("offset:")&&(a-=parseInt(e.slice("offset:".length)))}));var u=[];1===a&&u.push("one"),u.push("=".concat(a),"other");for(var c=0;c<u.length;c++){var f=u[c];if(f in l){var h=d(l[f],a),p=h.caseBody,v=h.numberValues;return n(p,g(g({},t),v))}}return e}function y(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0,s=o(r),i=s.cases;return e in i?n(i[e],t):"other"in i?n(i.other,t):e}export{p as MessageFormatter,u as findClosingBracket,o as parseCases,m as pluralTypeHandler,y as selectTypeHandler,c as splitFormattedArgument};
